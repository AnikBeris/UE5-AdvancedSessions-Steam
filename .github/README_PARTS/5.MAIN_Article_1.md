# Project - Maps & Modes

<div align="center">
  <img style="width: 90%; height: auto;" alt="Project-Maps&Modes" src="./media/Tutorial/Article_1/Project-Maps&Modes.png"/>
</div>

## Назначение раздела

Раздел **Project - Maps & Modes** определяет ключевые точки входа в игровой флоу и архитектуру проекта. В нем настраивается:

---

- какой `GameMode` используется по умолчанию;
- какие карты (maps) загружаются при старте редактора, игры и сервера;
- какие базовые классы применяются (`Pawn`, `Controller`, `HUD` и т.д.);
- как автоматически подменять `GameMode` в зависимости от карты или ее префикса.

Фактически это **точка входа в архитектуру игрового флоу**.

---

# Default Modes

<div align="center">
  <img style="width: 90%; height: auto;" alt="DefaultModes - Default GameMode" src="./media/Tutorial/Article_1/DefaultModes -Default GameMode.png"/>
</div>


## Default GameMode

**Default GameMode** - это `GameMode`, который будет использоваться:

- если карта не переопределяет `GameMode`;
- если `GameMode` не указан через URL-параметры;
- если не сработали префиксы или алиасы.


#### Типичное применение

- `GM_Menu` - главное меню
- `GM_Gameplay` - основная игра
- `GM_Lobby` - мультиплеерное лобби

#### Важно

- `GameMode` существует **только на сервере** ( или в singleplayer, как server-authority ).
- Клиенты получают данные через `GameState`.

---

## Selected GameMode

<div align="center">
  <img style="width: 90%; height: auto;" alt="DefaultModes - Default GameMode" src="./media/Tutorial/Article_1/DefaultModes -Selected GameMode.png"/>
</div>

Этот блок определяет набор классов для выбранного `GameMode` (в данном случае `GM_Menu`).

---

### Default Pawn Class

Определяет, какой `Pawn` будет автоматически заспавнен для игрока.

Примеры:

- `Pawn` - пустышка для меню
- `Character` - если нужен полноценный персонаж
- `SpectatorPawn` - если игрок не должен управлять телом

Для меню:

- часто используется пустой `Pawn` или минимальная логика без управления.

---

### HUD Class

Класс `HUD` (устаревший, но все еще поддерживаемый).

Используется, если:

- UI рисуется через `DrawHUD`;
- применяется старая HUD-логика.

Современная практика:

- `HUD` пустой;
- UI создается через **UMG** в `PlayerController`.

Для меню использование `HUD_Menu` допустимо.

---

### Player Controller Class

Один из ключевых классов архитектуры.

Отвечает за:

- ввод (`Input`);
- создание UI;
- управление камерой;
- переключение режимов ввода (UI / Game).

Примеры:

**В меню**
- `PC_Menu`
- включен `Show Mouse Cursor`
- `Set Input Mode UI Only`

**В игре**
- `PC_Gameplay`
- `Game Only` или `Game and UI`

---

### Game State Class

`GameState` существует **на сервере и клиентах**.

Используется для:

- таймеров;
- текущей фазы матча;
- глобального состояния игры.

Пример:

- `Server_GameState`

Даже в singleplayer рекомендуется хранить данные в `GameState`, а не в `GameMode`.

---

### Player State Class

`PlayerState` существует для каждого игрока.

Хранит:

- очки;
- имя;
- команду;
- перки;
- статистику.

Применение:

- в мультиплеере - обязательно;
- в singleplayer - рекомендуется.

---

### Spectator Class

`Pawn`, который используется:

- при смерти;
- при наблюдении;
- при отсутствии активного `Pawn`.

По умолчанию `SpectatorPawn` - корректный выбор.

---

## Advanced (GameMode)

<div align="center">
  <img style="width: 90%; height: auto;" alt="DefaultModes - Default GameMode" src="./media/Tutorial/Article_1/DefaultModes -Selected GameMode-Advanced.png"/>
</div>

### Global Default Server Game Mode

Используется **только для dedicated server**.

Если задан:

- сервер всегда будет использовать этот `GameMode`;
- независимо от карты.

Обычно:

- `None` - стандартный вариант;
- применяется в серверных сборках.

---

### Game Mode Map Prefixes

<div align="center">
  <img style="width: 80%; height: auto;" alt="DefaultModes - Default GameMode" src="./media/Tutorial/Article_1/DefaultModes -Selected GameMode-Advanced-Prefixes.png"/>
</div>

<div align="center">
  <img style="width: 40%; height: auto;" alt="DefaultModes - Default GameMode" src="./media/Tutorial/Article_1/DefaultModes -Selected GameMode-Advanced-PrefixesLevel.png"/>
</div>

Позволяет автоматически назначить `GameMode` по префиксу карты.

Пример:

- `MP_` -> `GM_Multiplayer`
- `SP_` -> `GM_Singleplayer`
- `MENU_` -> `GM_Menu`

#### Практическое применение

- одна сборка;
- разные режимы без ручной настройки карт.

Крайне полезно в средних и крупных проектах.

### Настройка в DefaultEngine.ini

```ini
[/Script/EngineSettings.GameMapsSettings]
+GameModeMapPrefixes=(Prefix="MENU_",GameMode="/Game/GameModes/GM_Menu.GM_Menu_C")
+GameModeMapPrefixes=(Prefix="SP_",GameMode="/Game/GameModes/GM_Single.GM_Single_C")
+GameModeMapPrefixes=(Prefix="MP_",GameMode="/Game/GameModes/GM_Multiplayer.GM_Multiplayer_C")
+GameModeMapPrefixes=(Prefix="COOP_",GameMode="/Game/GameModes/GM_Coop.GM_Coop_C")

```

---

### Game Mode Class Aliases

<div align="center">
  <img style="width: 90%; height: auto;" alt="DefaultModes - Default GameMode" src="./media/Tutorial/Article_1/DefaultModes -Selected GameMode-Advanced-Aliases.png"/>
</div>

Позволяет использовать короткие алиасы для `GameMode`. Когда карты тажа, а правила игры специфичны.

Пример классический PvP:

- `"DM"`   -> `GM_Deathmatch`
- `"TDM"`  -> `GM_TeamDeathmatch`
- `"CTF"`  -> `GM_CaptureTheFlag`
- `"FFA"`  -> `GM_FreeForAll`
- `"KOTH"` -> `GM_KingOfTheHill`
- `"SD"`   -> `GM_SearchAndDestroy`

Пример классический PvE:

- `"COOP"`  -> `GM_Coop`
- `"PVE"`   -> `GM_PvE`
- `"SURV"`  -> `GM_Survival`
- `"HORDE"` -> `GM_Horde`
- `"WAVES"` -> `GM_Waves`

Лобби и сервисные режимы:

- `"MENU"`  -> `GM_Menu`
- `"LOBBY"` -> `GM_Lobby`
- `"ENTRY"` -> `GM_Entry`

Одиночный режим:

- `"SP"`       -> `GM_Singleplayer`
- `"STORY"`    -> `GM_Story`
- `"CAMPAIGN"` -> `GM_Campaign`


### Настройка в DefaultEngine.ini

```ini
[/Script/EngineSettings.GameMapsSettings]
+GameModeClassAliases=(ShortName="DM",GameMode="/Game/GameModes/GM_Deathmatch.GM_Deathmatch_C")
+GameModeClassAliases=(ShortName="TDM",GameMode="/Game/GameModes/GM_TeamDeathmatch.GM_TeamDeathmatch_C")
+GameModeClassAliases=(ShortName="COOP",GameMode="/Game/GameModes/GM_Coop.GM_Coop_C")
+GameModeClassAliases=(ShortName="MENU",GameMode="/Game/GameModes/GM_Menu.GM_Menu_C")
```


## Применение на практике
### Через консоль или командную строку

```ini
open Lvl_Arena?game=DM
```

Unreal Engine ищет `DM` в `Game Mode Class Aliases`, игнорирует назначеный `Default GameMode` и заменяет его на `GM_Deathmatch`,


### Через Server Startup

```ini
UEGameServer.exe Lvl_Map?game=TDM?listen
```

### Очень удобно для:

- dedicated servers,
- CI/CD,
- автоматических тестов.

---

### Когда алиасы НЕ нужны

Алиасы не обязательны, если ты используешь:

- `Map Override` в World Settings,
- `Game Mode Map Prefixes`,
- жестко зафиксированый `Default GameMode`.

> В небольших singleplayer проектах алиасы часто вообще не используют.


### Рекомендованная схема для реального проекта

Использовать все три механизма, но по назначению:
|Механизм|Для чего|
|:---------:|:---------|
| Default GameMode | Безопасный fallback |
| Map Override | Явное поведение карты |
| Prefixes | Массовые карты |
| Aliases | CLI, сервер, автоматизация |

---






## Default Maps

<div align="center">
  <img style="width: 90%; height: auto;" alt="DefaultModes - Default GameMode" src="./media/Tutorial/Article_1/Default Maps.png"/>
</div>

### Editor Startup Map

Карта, которая:

- автоматически открывается при запуске редактора.

Рекомендация:

- легкая карта;
- не основная игровая сцена;
- часто тестовая или меню.

---

### Editor Template Map Overrides

Используется редко.

Назначение:

- переопределение шаблонных карт (template maps);
- актуально для кастомных шаблонов.

В большинстве проектов не используется.

---

### Game Default Map

Карта, которая:

- загружается при запуске игры;
- используется в packaged build.

Обычно:

- главное меню;
- либо стартовый уровень.

---

## Advanced (Maps)

<div align="center">
  <img style="width: 90%; height: auto;" alt="DefaultModes - Default GameMode" src="./media/Tutorial/Article_1/Default Maps - Advanced.png"/>
</div>

### Local Map Options

Позволяет задать URL-параметры по умолчанию.

Пример:

```ini
?listen?game=GM_Gameplay
```

Используется для:

- тестирования;
- локальных серверов;
- автоматических параметров запуска.

---

### Transition Map

Карта, которая:

- загружается временно при смене уровней (Seamless Travel).

Используется в мультиплеере:

- для избежания фризов;
- для плавного перехода между уровнями.

В singleplayer обычно не требуется.

---

### Server Default Map

Карта, которая:

- загружается при старте dedicated server.

Обычно:

- `Entry`;
- или `Lvl_Lobby`.

Важно:

- не влияет на клиента;
- применяется только в серверной сборке.

---

### Настройка в DefaultEngine.ini

```ini
[/Script/EngineSettings.GameMapsSettings]
GameDefaultMap=/Game/Maps/MENU_Main
EditorStartupMap=/Game/Maps/Test_Map
GlobalDefaultGameMode=/Game/GameModes/GM_Menu.GM_Menu_C

```
## Практическая рекомендация для текущей структуры

Типовая схема конфигурации:

- **Editor Startup Map** -> `TestMap`
- **Game Default Map**   -> `Lvl_Menu`
- **Default GameMode**   -> `GM_Menu`
- **Menu Map Override**  -> `GM_Menu`
- **Gameplay Maps**      -> `GM_Gameplay` (через Override или Prefix)

Данная схема обеспечивает чистое разделение меню, геймплея и серверной логики, а также упрощает масштабирование проекта.





* * * * * * * * * * * * * * * * * * 
* * * * * * * * * * * * * * * * * * 